PASS tests/unit/authorization.test.ts (33.621 s)
  Authorization Service
    Î“ÃªÃœ should pass a basic test (54 ms)

PASS tests/unit/authorization.service.test.ts (62.779 s)
  AuthorizationService
    checkPermission
      Î“ÃªÃœ should return allowed: true when permission is granted by policy (32 ms)
      Î“ÃªÃœ should return allowed: false when permission is denied by policy (3 ms)
      Î“ÃªÃœ should throw ValidationError if action is missing (35 ms)
      Î“ÃªÃœ should throw ValidationError if resource is missing (4 ms)
      Î“ÃªÃœ should throw PolicyLoadError if no policies are found (2 ms)
      Î“ÃªÃœ should throw PolicyEvaluationError if regoEngine.evaluate throws an error (5 ms)
      Î“ÃªÃœ should re-throw PolicyLoadError if caught (4 ms)
      Î“ÃªÃœ should re-throw PolicyEvaluationError if caught (3 ms)
      Î“ÃªÃœ should re-throw ValidationError if caught (2 ms)
    testPolicy
      Î“ÃªÃœ should return the evaluation result for a valid policy test (2 ms)
      Î“ÃªÃœ should throw ValidationError if policy string is empty (6 ms)
      Î“ÃªÃœ should throw PolicyEvaluationError if regoEngine.evaluate throws an error during testPolicy (3 ms)
      Î“ÃªÃœ should re-throw ValidationError if caught during testPolicy (5 ms)

  console.info
    [ConfigService] Reading configuration from process.env (expected to be populated by --env-file)

      at new EnvironmentConfigService (src/infrastructure/config/EnvironmentConfigService.ts:35:17)

  console.debug
    [ConfigService] Configuration loaded (keys only): [
      'ALLUSERSPROFILE',
      'ANDROID_HOME',
      'ANTIGRAVITY_AGENT',
      'ANTIGRAVITY_CLI_ALIAS',
      'APPDATA',
      'ChocolateyInstall',
      'ChocolateyLastPathUpdate',
      'CHROME_CRASHPAD_PIPE_NAME',
      'CLASSPATH',
      'COLOR',
      'COLORTERM',
      'CommonProgramFiles',
      'CommonProgramFiles(x86)',
      'CommonProgramW6432',
      'COMPUTERNAME',
      'ComSpec',
      'DriverData',
      'EDITOR',
      'GIT_ASKPASS',
      'GRADLE_HOME',
      'HOME',
      'HOMEDRIVE',
      'HOMEPATH',
      'INIT_CWD',
      'INTEL_DEV_REDIST',
      'JAVA_HOME',
      'JEST_WORKER_ID',
      'LANG',
      'LOCALAPPDATA',
      'LOGONSERVER',
      'MICROSOFT_WINDOWSAPPRUNTIME_BASE_DIRECTORY',
      'MIC_LD_LIBRARY_PATH',
      'NODE',
      'NODE_ENV',
      'NODE_PATH',
      'npm_command',
      'npm_config_cache',
      'npm_config_globalconfig',
      'npm_config_global_prefix',
      'npm_config_init_module',
      'npm_config_local_prefix',
      'npm_config_node_gyp',
      'npm_config_noproxy',
      'npm_config_npm_version',
      'npm_config_prefix',
      'npm_config_userconfig',
      'npm_config_user_agent',
      'npm_execpath',
      'npm_lifecycle_event',
      'npm_lifecycle_script',
      'npm_node_execpath',
      'npm_package_json',
      'npm_package_name',
      'npm_package_version',
      'NUMBER_OF_PROCESSORS',
      'NVM_HOME',
      'NVM_SYMLINK',
      'OneDrive',
      'OneDriveConsumer',
      'OS',
      'PAGER',
      'Path',
      'PATHEXT',
      'PNPM_HOME',
      'POSH_INSTALLER',
      'POSH_THEMES_PATH',
      'POWERSHELL_DISTRIBUTION_CHANNEL',
      'PROCESSOR_ARCHITECTURE',
      'PROCESSOR_IDENTIFIER',
      'PROCESSOR_LEVEL',
      'PROCESSOR_REVISION',
      'ProgramData',
      'ProgramFiles',
      'ProgramFiles(x86)',
      'ProgramW6432',
      'PROMPT',
      'PSModulePath',
      'PUBLIC',
      'SystemDrive',
      'SystemRoot',
      'TEMP',
      'TERM_PROGRAM',
      'TERM_PROGRAM_VERSION',
      'TMP',
      'TS_JEST',
      'USERDOMAIN',
      'USERDOMAIN_ROAMINGPROFILE',
      'USERNAME',
      'USERPROFILE',
      'VSCODE_GIT_ASKPASS_EXTRA_ARGS',
      'VSCODE_GIT_ASKPASS_MAIN',
      'VSCODE_GIT_ASKPASS_NODE',
      'VSCODE_GIT_IPC_HANDLE',
      'VSCODE_INJECTION',
      'VSCODE_PYTHON_AUTOACTIVATE_GUARD',
      'windir',
      'ZES_ENABLE_SYSMAN',
      'PORT',
      'LOG_LEVEL'
    ]

      at new EnvironmentConfigService (src/infrastructure/config/EnvironmentConfigService.ts:40:21)

  console.error
    [ConfigService] Missing or empty required environment variables: AWS_REGION, COGNITO_USER_POOL_ID, COGNITO_CLIENT_ID

    [0m [90m 43 |[39m         [36mif[39m (missingKeys[33m.[39mlength [33m>[39m [35m0[39m) {
     [90m 44 |[39m             [36mconst[39m errorMsg [33m=[39m [32m`[ConfigService] Missing or empty required environment variables: ${missingKeys.join(', ')}`[39m[33m;[39m
    [31m[1m>[22m[39m[90m 45 |[39m             console[33m.[39merror(errorMsg)[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 46 |[39m             [36mthrow[39m [36mnew[39m [33mError[39m(errorMsg)[33m;[39m
     [90m 47 |[39m         }
     [90m 48 |[39m         console[33m.[39minfo([32m'[ConfigService] Required configuration keys verified.'[39m)[33m;[39m[0m

      at new EnvironmentConfigService (src/infrastructure/config/EnvironmentConfigService.ts:45:21)
      at node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:295:28
      at InternalDependencyContainer.construct (node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:303:11)
      at InternalDependencyContainer.resolveRegistration (node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:169:51)
      at InternalDependencyContainer.resolve (node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:112:33)
      at Object.<anonymous> (src/container.ts:24:33)
      at Object.<anonymous> (tests/integration/authorization.routes.test.ts:6:1)

FAIL tests/integration/authorization.routes.test.ts
  Î“Ã¹Ã… Test suite failed to run

    [ConfigService] Missing or empty required environment variables: AWS_REGION, COGNITO_USER_POOL_ID, COGNITO_CLIENT_ID

      44 |             const errorMsg = `[ConfigService] Missing or empty required environment variables: ${missingKeys.join(', ')}`;
      45 |             console.error(errorMsg);
    > 46 |             throw new Error(errorMsg);
         |                   ^
      47 |         }
      48 |         console.info('[ConfigService] Required configuration keys verified.');
      49 |         // --- Add placeholder comment for future policy engine config ---

      at new EnvironmentConfigService (src/infrastructure/config/EnvironmentConfigService.ts:46:19)
      at node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:295:28
      at InternalDependencyContainer.construct (node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:303:11)
      at InternalDependencyContainer.resolveRegistration (node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:169:51)
      at InternalDependencyContainer.resolve (node_modules/.pnpm/tsyringe@4.10.0/node_modules/tsyringe/dist/cjs/dependency-container.js:112:33)
      at Object.<anonymous> (src/container.ts:24:33)
      at Object.<anonymous> (tests/integration/authorization.routes.test.ts:6:1)

---------------------------|---------|----------|---------|---------|-------------------
File                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------------|---------|----------|---------|---------|-------------------
All files                  |   96.03 |    86.11 |   88.88 |   96.03 |                   
 application/services      |   94.17 |    83.87 |     100 |   94.17 |                   
  authorization.service.ts |   94.17 |    83.87 |     100 |   94.17 | 42-44,47-49       
 domain/exceptions         |     100 |      100 |     100 |     100 |                   
  AuthorizationError.ts    |     100 |      100 |     100 |     100 |                   
 shared/constants          |     100 |      100 |     100 |     100 |                   
  types.ts                 |     100 |      100 |     100 |     100 |                   
 shared/errors             |   94.73 |      100 |   66.66 |   94.73 |                   
  BaseError.ts             |   94.73 |      100 |   66.66 |   94.73 | 34-35             
---------------------------|---------|----------|---------|---------|-------------------
Test Suites: 1 failed, 2 passed, 3 total
Tests:       14 passed, 14 total
Snapshots:   0 total
Time:        76.611 s, estimated 114 s
Ran all test suites.
